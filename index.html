<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Dashboard</title>
    <style>
        /* CSS STYLES */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .dashboard-container { max-width: 75rem; width: 100%; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .clock-card { background: white; border-radius: 1rem; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .clock { text-align: center; font-size: 4rem; font-family: monospace; font-weight: bold; color: #1e293b; letter-spacing: 0.1em; }
        .bars-container { display: flex; flex-direction: column; gap: 1rem; }
        .bar { background: #000; border-radius: 0.75rem; padding: 1.5rem; display: flex; align-items: center; justify-content: space-between; border: 1px solid #334155; transition: 0.3s; }
        .bar.active { background: #dc2626; border-color: #ef4444; transform: scale(1.02); }
        .bar-number { font-size: 1.875rem; font-weight: bold; width: 3rem; }
        .bar-time { padding: 0.5rem 1rem; background: rgba(255,255,255,0.1); border-radius: 0.5rem; font-family: monospace; font-size: 1.25rem; }
        @media (max-width: 768px) { .clock { font-size: 2.5rem; } .bar { flex-direction: column; } }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1 id="dayTitle">Loading...</h1>
            <div id="status" style="color: #94a3b8;">Checking CSV...</div>
        </div>
        <div class="clock-card"><div class="clock" id="clock">00:00:00</div></div>
        <div class="bars-container" id="barsContainer"></div>
    </div>

    <script>
        // JAVASCRIPT LOGIC
        const CSV_PATH = './data/schedule.csv';
        let presetData = {};
        let selectedDay = new Date().getDate();

        async function init() {
            try {
                const response = await fetch(CSV_PATH);
                if (!response.ok) throw new Error();
                const text = await response.text();
                parseCSV(text);
                document.getElementById('status').textContent = "Connected";
            } catch (e) {
                document.getElementById('status').textContent = "CSV Not Found";
            }

            document.getElementById('dayTitle').textContent = `Day ${selectedDay} Schedule`;
            createBars();
            setInterval(updateClock, 1000);
        }

        function parseCSV(text) {
            const lines = text.trim().split('\n');
            for (let i = 1; i < lines.length; i++) {
                const [day, bar, h, m, s] = lines[i].split(',').map(item => parseInt(item.trim()));
                if (!presetData[day]) presetData[day] = {};
                if (!presetData[day][`bar${bar}`]) presetData[day][`bar${bar}`] = [];
                presetData[day][`bar${bar}`].push({ h, m, s });
            }
        }

        function createBars() {
            const container = document.getElementById('barsContainer');
            for (let i = 6; i >= 1; i--) {
                const div = document.createElement('div');
                div.className = 'bar';
                div.id = `bar${i}`;
                div.innerHTML = `
                    <div class="bar-number">${i}</div>
                    <div class="bar-time" id="time${i}">--:--:--</div>
                    <div class="bar-status" id="status${i}">○ IDLE</div>`;
                container.appendChild(div);
            }
        }

        function updateClock() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toTimeString().split(' ')[0];

            const dayData = presetData[selectedDay] || {};
            for (let i = 1; i <= 6; i++) {
                const barDiv = document.getElementById(`bar${i}`);
                const times = dayData[`bar${i}`] || [];
                const isActive = times.some(t => t.h === now.getHours() && t.m === now.getMinutes() && t.s === now.getSeconds());

                if (isActive) {
                    barDiv.classList.add('active');
                    document.getElementById(`status${i}`).textContent = '● ACTIVE';
                } else {
                    barDiv.classList.remove('active');
                    document.getElementById(`status${i}`).textContent = '○ IDLE';
                }
            }
        }

        init();
    </script>
</body>
</html>
