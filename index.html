<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Vertical Bar Monitor - Auto Load</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #121212; color: white; display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px; }
        
        /* Setup Panel */
        .setup-panel { background: #1e1e1e; padding: 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 320px; text-align: center; border: 1px solid #333; }
        label { display: block; text-align: left; margin: 10px 0 5px 5px; font-size: 0.9rem; color: #aaa; }
        input { width: 90%; padding: 12px; margin-bottom: 15px; border-radius: 6px; border: 1px solid #444; background: #2a2a2a; color: white; font-size: 1rem; }
        button { width: 100%; padding: 15px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 1rem; transition: 0.2s; }
        button:hover { background: #0056b3; transform: translateY(-2px); }

        /* Dashboard */
        #display-clock { font-size: 5rem; margin: 10px; color: #00ff41; font-family: 'Courier New', monospace; font-weight: bold; text-shadow: 0 0 15px rgba(0, 255, 65, 0.3); }

        /* Vertical Stack Layout */
        .stack-container { display: flex; flex-direction: column; gap: 12px; width: 450px; margin-top: 20px; }
        .bar-row { 
            display: flex; align-items: center; background: #262626; 
            border: 2px solid #3d3d3d; border-radius: 10px; height: 70px;
            transition: all 0.2s ease; position: relative; overflow: hidden;
        }
        .bar-label { width: 70px; font-size: 1.8rem; font-weight: bold; border-right: 2px solid #3d3d3d; height: 100%; display: flex; align-items: center; justify-content: center; background: #2d2d2d; }
        .bar-info { flex-grow: 1; text-align: right; padding-right: 25px; font-size: 1.2rem; }
        .next-time { color: #00d4ff; font-weight: bold; font-family: monospace; font-size: 1.4rem; margin-left: 10px; }
    </style>
</head>
<body>

    <div class="setup-panel" id="setup">
        <h2 style="margin-top:0;">Monitor Setup</h2>
        <label>Enter Day (CSV Filename):</label>
        <input type="number" id="dayInput" value="1" min="1" max="31">
        
        <label>Start Time (24hr):</label>
        <input type="text" id="timeInput" value="14:20:00" placeholder="HH:MM:SS">
        
        <button onclick="initMonitor()">RUN MONITOR</button>
    </div>

    <div id="monitor-ui" style="display:none; text-align: center;">
        <div id="display-clock">00:00:00</div>
        <div class="stack-container">
            <div class="bar-row" id="row-6"><div class="bar-label">6</div><div class="bar-info">Next: <span class="next-time" id="next-6">--:--:--</span></div></div>
            <div class="bar-row" id="row-5"><div class="bar-label">5</div><div class="bar-info">Next: <span class="next-time" id="next-5">--:--:--</span></div></div>
            <div class="bar-row" id="row-4"><div class="bar-label">4</div><div class="bar-info">Next: <span class="next-time" id="next-4">--:--:--</span></div></div>
            <div class="bar-row" id="row-3"><div class="bar-label">3</div><div class="bar-info">Next: <span class="next-time" id="next-3">--:--:--</span></div></div>
            <div class="bar-row" id="row-2"><div class="bar-label">2</div><div class="bar-info">Next: <span class="next-time" id="next-2">--:--:--</span></div></div>
            <div class="bar-row" id="row-1"><div class="bar-label">1</div><div class="bar-info">Next: <span class="next-time" id="next-1">--:--:--</span></div></div>
        </div>
    </div>

    <script>
        let schedule = [];
        let runningTime = new Date();

        async function initMonitor() {
            const day = document.getElementById('dayInput').value;
            const timeVal = document.getElementById('timeInput').value;
            
            // Try to fetch the CSV from the /data folder
            try {
                const response = await fetch(`data/${day}.csv`);
                if (!response.ok) throw new Error("File not found");
                const text = await response.text();
                
                parseCSV(text);
                
                const [h, m, s] = timeVal.split(':');
                runningTime.setHours(parseInt(h), parseInt(m), parseInt(s || 0));

                document.getElementById('setup').style.display = 'none';
                document.getElementById('monitor-ui').style.display = 'block';
                
                setInterval(tick, 1000);
            } catch (error) {
                alert("Error: Could not find " + day + ".csv in the /data folder. Ensure you are running this through a local server.");
            }
        }

        function parseCSV(data) {
            const lines = data.split('\n');
            for (let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if (cols.length >= 5) {
                    schedule.push({
                        bar: cols[1].trim(),
                        timeStr: `${cols[2].trim().padStart(2,'0')}:${cols[3].trim().padStart(2,'0')}:${cols[4].trim().padStart(2,'0')}`
                    });
                }
            }
        }

        function tick() {
            runningTime.setSeconds(runningTime.getSeconds() + 1);
            const nowStr = runningTime.toTimeString().split(' ')[0];
            document.getElementById('display-clock').innerText = nowStr;

            for (let i = 1; i <= 6; i++) {
                const barId = i.toString();
                const rowElement = document.getElementById('row-' + barId);
                const nextElement = document.getElementById('next-' + barId);

                // Check for current match
                const isMatch = schedule.find(item => item.bar === barId && item.timeStr === nowStr);
                if (isMatch) {
                    rowElement.style.backgroundColor = '#ff0000';
                    rowElement.style.borderColor = '#ff6666';
                    rowElement.style.transform = 'scale(1.03)';
                    setTimeout(() => { 
                        rowElement.style.backgroundColor = '#262626'; 
                        rowElement.style.borderColor = '#3d3d3d';
                        rowElement.style.transform = 'scale(1)';
                    }, 2000);
                }

                // Find next time
                const upcoming = schedule
                    .filter(item => item.bar === barId && item.timeStr > nowStr)
                    .sort((a, b) => a.timeStr.localeCompare(b.timeStr))[0];

                nextElement.innerText = upcoming ? upcoming.timeStr : "DONE";
            }
        }
    </script>
</body>
</html>
